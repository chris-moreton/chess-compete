# SPSA Tuning Configuration
#
# This file contains hyperparameters for the SPSA algorithm and
# general tuning settings. Unlike params.toml, this file is not
# automatically updated - modify manually to change tuning behavior.

# =============================================================================
# TIME CONTROL
# =============================================================================
# Consistent naming with chess-compete CLI (--timelow, --timehigh)

[time_control]
timelow = 0.25       # Minimum seconds per move
timehigh = 0.5       # Maximum seconds per move (random within range)

# =============================================================================
# GAMES PER ITERATION
# =============================================================================

[games]
games_per_iteration = 500  # Target games before calculating gradient
batch_size = 1              # Games per worker batch (for status updates)

# =============================================================================
# SPSA ALGORITHM HYPERPARAMETERS
# =============================================================================
# Standard SPSA formulas:
#   a_k = a / (k + A)^alpha      (step size, decreases over time)
#   c_k = c / k^gamma            (perturbation size, decreases over time)
#
# Where k is the iteration number (1-indexed)
#
# These values are based on common recommendations:
# - alpha = 0.602 (theoretical optimal for noisy gradient)
# - gamma = 0.101 (slower decay for perturbations)
# - A = ~10% of max iterations (stability early on)

[spsa]
max_iterations = 1500    # Stop after this many iterations
a = 1.0                  # Step size numerator
c = 1.0                  # Perturbation size multiplier (multiplied by param's step)
A = 50                   # Stability constant (larger = more conservative early)
alpha = 0.602            # Step size decay exponent
gamma = 0.101            # Perturbation decay exponent

# Effective iteration offset: effective_k = iteration_number - offset
# Set this when absorbing parameters to reset learning rates
# Example: if at iteration 400 and you want effective_k=50, set offset=350
effective_iteration_offset = 118

# =============================================================================
# BUILD CONFIGURATION
# =============================================================================

[build]
# Path to rusty-rival source (relative to chess-compete directory or absolute)
rusty_rival_path = "../rusty-rival"

# Where to put built engines (relative to chess-compete directory or absolute)
engines_output_path = "engines/spsa"

# Engine binary names (will create subdirectories)
plus_engine_name = "spsa-plus"
minus_engine_name = "spsa-minus"
base_engine_name = "spsa-base"

# =============================================================================
# REFERENCE ENGINE (for tracking actual strength over time)
# =============================================================================

[reference]
# Path to reference engine (relative to chess-compete directory or absolute)
engine_path = "../rusty-rival/engines/stockfish"
engine_elo = 2600  # Assumed Elo of reference engine
enabled = true     # Set to false to disable reference games
ratio = 0.25       # Reference games per SPSA game (0.25 = 1 ref per 4 SPSA = 100 ref for 400 SPSA)

# =============================================================================
# DATABASE
# =============================================================================

[database]
# Connection is read from DATABASE_URL environment variable
# This matches chess-compete's configuration approach

# Poll interval when waiting for workers to complete games
poll_interval_seconds = 5
